<div class="loading spin" ng-show="working"></div>

<alert ng-repeat="alert in getAlerts()"
       type="alert.type"
       close="closeAlert($index)">{{alert.msg}}</alert>

<div ng-hide="working">

  <div class="search-bar text-center">
      <button type="submit" 
              ng-click="toggleStarFilter()"
              class="btn btn-default"
              ng-class="{true:'active'}[filterStared]"
              tooltip-placement="bottom"
              tooltip="Filter starred">
        <i class="glyphicon"
           ng-class="{true:'glyphicon-star', false:'glyphicon-star-empty'}[filterStared]"></i>
      </button>
    <input class="input" 
           placeholder="Filter your projects" 
           type="text"
           ng-model="projectSearch.name">
      <button type="submit" class="btn btn-default" ng-click="refresh()" tooltip="Refresh" tooltip-placement="bottom">
        <i class="glyphicon glyphicon-refresh" ng-class="{spin: refreshing}" disabled="refreshing"></i>
      </button>
  </div>

  <accordion close-others="true">
    <accordion-group ng-repeat='project in $parent.filteredProjects = ( projects | filterStarred:this | filter:projectSearch | limitTo: pageLimit() )' is-open="project.open" >
      <accordion-heading >
        <div ng-click="showProject(project)">
          {{project.owner}}/{{project.name}}
          <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': project.open, 'glyphicon-chevron-right': !project.open}"></i>
        </div>
      </accordion-heading>

      <ol class="breadcrumb text-center">
        <li>
          <a href="#" tooltip-placement="bottom" tooltip="Toggle star"
             ng-click="toggleStar(project); $event.preventDefault()">
            <i class="glyphicon"
               ng-class="{true:'glyphicon-star', false:'glyphicon-star-empty gray'}[isStarred(project)]"></i>
          </a>
        </li>
        <li>
          <a href="#" tooltip-placement="bottom" tooltip="Notifications"
             ng-click="toggleNotification(project); $event.preventDefault()">
            <i class="glyphicon glyphicon-bell"
               ng-class="{false:'gray'}[haveNotification(project)]"></i>
          </a> 
        </li>
        <li>
          <a href="https://github.com/{{project.owner + '/' + project.name}}" tooltip-placement="bottom" target="_blank" tooltip="View on GitHub"> 
            <i class="glyphicon glyphicon-cloud "></i>
          </a> 
        </li>
        <li>
          <a href="#" tooltip-placement="bottom" target="_blank" tooltip="View on Semaphore"> 
            <i class="glyphicon glyphicon-new-window"></i>
          </a> 
        </li>
      </ol>
      </ol>

      <table class="table">
          <tbody>
            <tr class="{{branch.result}} branch" ng-repeat="branch in project.branches | orderBy:'branch_name'">

              <td>
                <a href="{{branch.branch_url}}" target="_blank"> {{branch.branch_name}}</a>
              </td>
              <td class="text-right small">
                <a href="{{branch.build_url}}" target="_blank">{{branch.finished_at || branch.started_at | fromNow}}</a>
              </td>
              
            </tr>

            <ol class="breadcrumb text-center" ng-hide="project.branches.length">
              <li class="active">This project have no branches</li>
            </ol>

          </tbody>
        </table>

    </accordion-group>

    <figure ng-hide="filteredProjects.length">
      <h1 class="token-label">
        Project </br>you seek </br>can't be located.
      </h1>
    </figure>

  </accordion>

  <div class="text-center more">
    <button type="button"
            class="btn btn-default"
            ng-show="morePages"
            ng-click="nextPage()"> Show more</button>
  </div>
</div>
